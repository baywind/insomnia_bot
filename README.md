# Forwarder bot

Это бот для Telegram, предназначенный для пересылки сообщений сторонних пользователей в закрытый чат команды и возвращения ему ответов из чата.

Бот уже используется для команд некоторых направлений при организации фестиваля Бессонница.

Бот построен на использвании webhook в Telegram API без использования специальных библиотек-обёрток.
Подробнее: https://core.telegram.org/bots/webhooks

## Принцип работы

Программа представляет собой движок, в котором можно регистрировать ботоы для разных команд.

Любой пользователь Telegram может подключиться к боту.
Сообщения, которые пользователь отправит боту пересылаются в закрытый чат команды, которой принадлежит этот бот.

Любой из участников чата может ответить на сообщение (стандартным способом для Telegram), и бот перешлёт этот ответ автору оригинального сообщения.

Таким образом внешнему пользователю не нужно решать, к кому именно из команды обращаться — на его вопрос может ответить любой представитель из закрытого чата.
Предварительно ответ можно обсудить внутри команды, а вопрошающему отправить уже согласованный командой «вердикт».

## Как запустить бота

Инструкция предполагает использование туннеля ngrok

1.  зарегистрировать своего бота с помощью [@BotFather](https://t.me/botfather)

2.  отредактировать файл webhook_setter.py:
    * вставить значение API_KEY, который выдал BotFather
    * вставить url, на котором доступен сервис бота.
    (например, доступный через ngrok. обязательно https)

3.  выполнить webhook_setter.py

    Проверить успешность регистрации бота и webhook можно с помощью logger_server.py — он просто выдаёт в консоль все обращения.
    Если направить на него webhook, можно видеть json-структуру запросов от Telegram при обращенях к боту.
    
    Менять url-адрес webhook можно сколько угодно раз, используя webhook_setter.py
    
4.  добавить бота в группу в Telegram

5.  назначить эту группу целевой для бота

6.  проверить работу бота:
    * написать сообщение боту от имени любого пользователя
    * убедиться, что это сообщение появилось в группе
    * ответить на сообщение в группе
    * убедиться, что ответное сообщение отправилось пользователю